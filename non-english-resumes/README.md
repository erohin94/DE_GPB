# Resume Language Filter

Утилита для автоматического исключения резюме на английском языке из профилей кандидатов.

# Описание задачи

При скачивании резюме кандидатов, часть резюме приходит на англиском языке. Необходимо исключить такие резюме.

# Решение

Изначально поиск таких резюме осуществлялся с помощью библиотеки `langdetect`. Но как выяснилось в ходе тестов, библиотека некорректно определяет язык для коротких текстов.
Например слово "Бармен" - библиотека считает что написано не на русском языке.

Было принято решение использовать для поиска регулярки. 
Тоесть скрипт анализирует текстовые поля резюме и подсчитывает количество символов, принадлежащих к кириллическому и латинскому алфавитам. 
Язык определяется по преобладающему алфавиту. Если в тексте больше или равно 80% текста на английском, то считаем что резюме на английском.
Если например в резюме 79% текста на английском и 21% на русском, то резюме считаем русским и такое резюме подходит.

Ноутбук с примером во вложении. В дальнейшем эта функция будет встроена в основной ETL скрипт.

**Логика работы ETL**

По поисковым шаблонам, скачиваются резюме и формируется датафрейм `df_resume_list`(хранится в памяти) с полями ('resume_id', 'owner_id','url', 'url_w_contacts','vacancy_code', 'search_status','area_id'), 
на основе которого собирается таблица (search_result_table) в Hadoop. Далее по этим id из таблицы `search_result_table` отправляются запросы к API на скачивание полных резюме.
На этапе скачивания полных резюме происходит проверка на рус-англ язык, если обнаруживается англ.яз, то id с резюме на англ.яз добавляется в список `eng_resume_ids`. После отрабатывания этого этапа, по скавчиванию полных резюме, добавляем полные резюме в таблицу Hadoop (в таблице хранятся резюме на англ.яз и на рус.яз).
Далее формируем фильтр `df_eng_filter`, для исключения из датафрейма `df_resume_list`, который хранится в памяти, резюме на англ.яз для кодов вакансий (1003, 1004, 10012). Обновляем датафрейм `df_resume_list`, теперь в датафрейме остались нужные id и коды вакансий. После чего очищаю ранее созданную таблицу `search_result_table` в Hadoop и добавляю новые данные из обновленного `df_resume_list`. Таким образом получим, что в таблице `search_result_table`, будут только те id и коды вакансий, которые нужны для дальнейших расчетов. Эта таблица является основой, с ней происходят все JOIN в дальнейших расчетах.

Бывают случаи когда к одному id, может относится несколько кодов вакансий. 
И например, нам надо исключить резюме на англ.яз для кодов вакансий (1003, 1004, 10012), но нашелся id резюме, у которого два кода вакансий, один из списка 10012, другой нет 1008. Надо удалить id с кодом 10012 и оставить этот же id с кодом 1008. Чтобы при дальнейших JOIN у нас не всплывал id с кодом вакансии 10012. Для этого делаем фильтр `df_eng_filter`, который исключает не нужные строки.
